\RequirePackage[titles]{tocloft}
\RequirePackage[newparttoc,noindentafter]{titlesec}	% Used to adjust (sub)section formatting
\RequirePackage{amssymb}
\RequirePackage{float}    % To force placement
\RequirePackage{etoolbox}



% Part splash page
\newkeycommand\pfMakeSplashHeader[
  image=,
  title=Title,
  headerHeight=headerHeight,
  textBodyHeight=textBodyHeight  
]{
  \begin{figure*}[h]
    \iftoggle{side-toc}{
      \ifnumodd{\thepage}{
        \vspace*{-0.8cm}
        \hspace*{-2.2cm}
        \def\splashWidth{\paperwidth-\pf@sideTocWidth}
      }{
        \vspace*{-0.8cm}
        \hspace*{-1.5cm}
        \def\splashWidth{\paperwidth-2.7cm}
      }
    }{
      \vspace*{-1.5cm}
      \hspace*{-1.5cm}
      \def\splashWidth{\paperwidth}
    }
    \makebox[\splashWidth][c]{
      \includegraphics[width=\splashWidth,height=15cm,keepaspectratio]{\commandkey{image}}
    }
  \end{figure*}
}


% Adjust section and subsection colors and font (change 0em to 1em if you commented the removal of section numbering)
%\titleformat{} % cmd
%[] % shape : hang, block, display, runin, leftmargin, rightmargin, drop, wrap, frame
%{} % format
%{} % label
%{} % sep
%{} % before code
%[] % after code

% \titlespacing*{<command>}{<left>}{<before-sep>}{<after-sep>}[<right-sep>]


%%%%%%%%%%%%%% \part

\titleformat{\part}
[display]
{\fontsize{50pt}{50pt}\selectfont\color{title1}\filcenter}
{\partname \thepart}
{-15pt}
{}

\titlespacing*{\part}{0pt}{-54pt}{0pt}

%%%%%%%%%%%%%% \chapter

\titleformat{\chapter}
[block]
% {\thispagestyle{chapter}\vspace{-80pt}\color{title1}\pfChapterFont}
% {\flushright \normalsize \color{title1} \MakeUppercase{\chaptertitlename}{\fontsize{50}{50}\selectfont \color{title1}\thechapter}}
{}
{\centering\pfChapterSubFont\chaptertitlename\ \thechapter:\\[-0.8em]}
{-1em}
{\centering\pfChapterFont}
% [{\titleline{\color{undergold}\titlerule[2pt]}}\vspace{-30pt}]

\titlespacing{\chapter}{0pt}{0pt}{0pt}

%%%%%%%%%%%%%% \section

\titleformat{\section}%[block]
{\pfSectionFont\centering}
{\thesection}
{0.5em}
{}
% [{\titleline{\color{undergold}\titlerule[0.5pt]}}]

\titlespacing{\section}{0pt}{1em}{0pt}

%%%%%%%%%%%%%% \subsection

\titleformat{\subsection}%[block]
{\pfSubsectionFont}{\thesubsection}{0.5em}{}
%[{\titleline{\color{title2}\titlerule[0.5pt]}}]

\titlespacing{\subsection}{0pt}{1em}{0pt}

%%%%%%%%%%%%%% \subsubsection

\titleformat{\subsubsection}
{\pfSubsubsectionFont}{\thesubsubsection}{0em}{}[]

\titlespacing{\subsubsection}{0pt}{1em}{0pt}

%%%%%%%%%%%%%% \paragraph

\titleformat{\paragraph}
{\pfParagraphFont}{\theparagraph}{0em}{}

%%%%%%%%%%%%%% \subparagraph

\titleformat{\subparagraph}[runin]
{\pfSubparagraphFont}
{\thesubparagraph\quad}
{0pt}
{}
[.]

% \titleformat{\subparagraph*}[runin]
% {\pfSubparagraphFont}
% {\thesubparagraph\quad}
% {0pt}
% {}

\titlespacing*{\subparagraph}{\parindent}{\parskip}{\wordsep}

%%%%%%%%%%%%%% \subtitle

% Special command for magic items, traps, and the like.
\newcommand{\subtitlesection}[2]{
  \subsubsection{#1}\vspace{-1ex}
  \textit{#2}\vspace{1ex}\par
}

