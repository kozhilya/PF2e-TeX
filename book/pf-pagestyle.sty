\RequirePackage{fancyhdr}         % Adaptation of the footers
\RequirePackage{tikz}            % For drawing
\RequirePackage{etoolbox}        % For \apptocmd
\RequirePackage{rotating}        % For vertical text
\RequirePackage{hyperref}        % Needed for \Hy@org@chapter
\RequirePackage{xstring}         % Needed for \ifthenelse

% Setup for custom footer
\pagestyle{fancy}

\newlength{\nobgfooterheight}
\setlength{\nobgfooterheight}{\paperheight}
\addtolength{\nobgfooterheight}{-1in}
\addtolength{\nobgfooterheight}{-\topmargin}
\addtolength{\nobgfooterheight}{-\headheight}
\addtolength{\nobgfooterheight}{-\headsep}
\addtolength{\nobgfooterheight}{-\textheight}
\addtolength{\nobgfooterheight}{-\footskip}

\newcommand{\background}{book/img/background}
\newcommand{\backgroundl}{book/img/pageleft}
\newcommand{\backgroundr}{book/img/pageright}

\newcommand{\footerPageXShift}{1.25cm}
\newcommand{\footerPageYShift}{1.0cm}

\renewcommand{\headrulewidth}{0.0pt} %no rule for header
\renewcommand{\footrulewidth}{0.0pt} %no rule for footer

\newcommand{\pf@renderPageNumber}{\pfPageNumberFont\textcolor{pfFooterColor}{\thepage}}

\fancyhf{} % clear all headers and footers

\fancyhead[O]{
  \begin{tikzpicture}[remember picture,overlay]
    \node[inner sep=0pt] at (current page.center) {\includegraphics[width=\paperwidth,height=\paperheight]{\backgroundr}};
    \node[xshift=-\footerPageXShift,yshift=\footerPageYShift] at (current page.south east) {\pf@renderPageNumber};
    \pf@renderSideTocChapter
  \end{tikzpicture}%
}

\fancyhead[E]{
  \begin{tikzpicture}[remember picture,overlay]
    \node[inner sep=0pt] at (current page.center) {\includegraphics[width=\paperwidth,height=\paperheight]{\backgroundl}};
    \node[xshift=\footerPageXShift,yshift=\footerPageYShift] at (current page.south west) {\pf@renderPageNumber};
  \end{tikzpicture}
}

\fancypagestyle{plain}{}

\fancypagestyle{splash}{
  \fancyhf{} % clear all headers and footers

  \fancyhead[O]{
    \begin{tikzpicture}[remember picture,overlay]
      \renderSplashImage
      \node[inner sep=0pt] at (current page.center) {\includegraphics[width=\paperwidth,height=\paperheight]{\backgroundr}};
      \node[xshift=\footerPageXShift,yshift=\footerPageYShift] at (current page.south west) {\pf@renderPageNumber!};
      \pf@renderSideTocChapter
    \end{tikzpicture}
  }

  \fancyhead[E]{
    \begin{tikzpicture}[remember picture,overlay]
      \renderSplashImage
      \node[inner sep=0pt] at (current page.center) {\includegraphics[width=\paperwidth,height=\paperheight]{\backgroundl}};
      \node[xshift=\footerPageXShift,yshift=\footerPageYShift] at (current page.south west) {\pf@renderPageNumber!};
    \end{tikzpicture}
  }
}

