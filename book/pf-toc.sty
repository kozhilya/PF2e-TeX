\RequirePackage{titletoc}
\RequirePackage{etoolbox}

% TOC types:
%   - onecolumn - Chapters and sections in 1 column.
%   - twocolumn - Chapters and sections in common 2 columns enviroment.
%   - mixed - Chapters in wide, sections of same shpater in 2 columns.

\typeout{tocStyle value = \pf@tocStyle}
% Explain \strcompare to TeX
\ExplSyntaxOn
\cs_new_eq:NN \strcompare \str_if_eq:eeTF
\ExplSyntaxOff

% One column TOC
\strcompare{\pf@tocStyle}{onecolumn}{%
  \typeout{tocStyle = onecolumn}

  \renewcommand{\tableofcontents}{%
    \chapter*{\contentsname}
    \@starttoc{toc}
  }
}{}

% Two column TOC
\strcompare{\pf@tocStyle}{twocolumn}{%
  \typeout{tocStyle = twocolumn}

  \renewcommand{\tableofcontents}{%
    \chapter*{\contentsname}
    \begin{multicols}{2}
      \@starttoc{toc}
    \end{multicols}
  }
}{}

% Mixed column TOC

\strcompare{\pf@tocStyle}{mixed}{%
  \typeout{tocStyle = mixed}%
  
  % I couldn't figure it out myself.
  % OpenAI and Deppseek either.
  % Stack Overflow did.
  % We are still alive!!!
  % https://tex.stackexchange.com/questions/746229/mixing-columns-count-in-table-of-contents

  \RequirePackage{etoc}

  \setcounter{tocdepth}{1} % Parts, chapters and sections

  \renewcommand*\l@chapter{\@dottedtocline{0}{1.5em}{2.3em}}
  \renewcommand*\l@section{\@dottedtocline{1}{0em}{0em}}

  \etocsetstyle{chapter}
    {}
    {}
    {\l@chapter{\numberline{\chaptertitlename \etocnumber}\etocname}{\etocpage}}
    {}
  \etocsetstyle{section}
    {\begin{multicols}{2}}
    {}
    {\l@section{\numberline{\etocnumber}\etocname}{\etocpage}}
    {\end{multicols}}
}{}

%{\@dottedtocline{2}{1.5em}{2.3em}{\etocifnumbered{\numberline{etocnumber}}{}%
%\etocname}{\etocpage}}