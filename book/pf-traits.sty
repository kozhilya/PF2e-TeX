\RequirePackage{tcolorbox}
\RequirePackage{wrapfig}

% \setlength{\wrapoverhang}{\marginparwidth}
% \addtolength{\wrapoverhang}{\marginparsep}

% This is unused and will be removed, use \trait{} instead
% \newcommand{\traits}[1]{%
%   \setlength\intextsep{0pt}%
%   \begin{wrapfigure}{l}[2mm]{1.1cm}%
%     \centering
%     \begin{tcolorbox}[width=1.778cm,
%                       colframe=tagborder,
%                       colback=tagbg,
%                       arc=1mm,
%                       box align=center,
%                       halign=flush center,
%                       left*=0mm,
%                       right*=0mm,
%                       nobeforeafter,
%                     ]%
%       \pfTraitFont{} #1
%     \end{tcolorbox}%
%   \end{wrapfigure}%
% }

\def\pf@traitHeight{1.4em}
\def\pf@traitTBrule{0.8pt}
\def\pf@traitLRrule{2.5pt}
\def\pf@traitLR{-0.5pt}

\newcommand{\metatrait}[3]{%
  \noindent\setlength\intextsep{0pt}%
  \begin{tcolorbox}[
    hbox,
    % parbox=true,
    % tcbox raise base,
    colframe=#1,
    colback=#2,
    sharp corners,
    valign=center,
    halign=center,
    baseline=0.0mm,
    left=\pf@traitLR,
    right=\pf@traitLR,
    height=\pf@traitHeight,
    toprule=\pf@traitTBrule,
    bottomrule=\pf@traitTBrule,
    leftrule=\pf@traitLRrule,
    rightrule=\pf@traitLRrule,
    enlarge right by=-\pf@traitLRrule,
    nobeforeafter,
  ]%
    {\pfTraitFont{#3}}%
  \end{tcolorbox}%
  \ignorespaces%
}

% Basic trait command
\newcommand{\trait}[1]{\metatrait{traitborder}{traitbg}{#1}}

% Size traits
\newcommand{\sizetrait}[1]{\metatrait{traitborder}{sizeColor}{#1}}

\newcommand{\pfTiny}{\sizetrait{\traittinytext}}
\newcommand{\pfSmall}{\sizetrait{\traitsmalltext}}
\newcommand{\pfMedium}{\sizetrait{\traitmediumtext}}
\newcommand{\pfLarge}{\sizetrait{\traitlargetext}}
\newcommand{\pfHuge}{\sizetrait{\traithugetext}}
\newcommand{\pfGargantuan}{\sizetrait{\traitgargantuantext}}

% Alignment traits
\newcommand{\aligntrait}[1]{\metatrait{traitborder}{alignColor}{#1}}

\newcommand{\pfLG}{\aligntrait{\traitLGtext}}
\newcommand{\pfNG}{\aligntrait{\traitNGtext}}
\newcommand{\pfCG}{\aligntrait{\traitCGtext}}

\newcommand{\pfLN}{\aligntrait{\traitLNtext}}
\newcommand{\pfN}{\aligntrait{\traitNNtext}}
\newcommand{\pfCN}{\aligntrait{\traitCNtext}}

\newcommand{\pfLE}{\aligntrait{\traitLEtext}}
\newcommand{\pfNE}{\aligntrait{\traitNEtext}}
\newcommand{\pfCE}{\aligntrait{\traitCEtext}}

% Commonality traits
\newcommand{\pfUncommon}{\metatrait{traitborder}{uncommonColor}{\traitUncommontext}}
\newcommand{\pfRare}{\metatrait{traitborder}{rareColor}{\traitRaretext}}
\newcommand{\pfUnique}{\metatrait{traitborder}{uniqueColor}{\traitUniquetext}}
